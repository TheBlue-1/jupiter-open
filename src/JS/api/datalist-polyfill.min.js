/*
 * datalist-polyfill.js - https://github.com/mfranzke/datalist-polyfill
 * @license Copyright(c) 2017 by Maximilian Franzke
 * Supported by Christian, Johannes, @mitchhentges, @mertenhanisch, @ailintom, @Kravimir, Michael, @hryamzik, @ottoville, @IceCreamYou, @wlekin and @eddr - many thanks for that !
 */
var DragDropTouch;!function(t){"use strict";var e=function(){function t(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(t.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){this._dropEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(t){this._effectAllowed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),t.prototype.clearData=function(t){null!=t?delete this._data[t]:this._data=null},t.prototype.getData=function(t){return this._data[t]||""},t.prototype.setData=function(t,e){this._data[t]=e},t.prototype.setDragImage=function(t,e,i){var n=o._instance;n._imgCustom=t,n._imgOffset={x:e,y:i}},t}();t.DataTransfer=e;var o=function(){function a(){if(this._lastClick=0,a._instance)throw"DragDropTouch instance already created.";var t=!1;if(document.addEventListener("test",function(){},{get passive(){return t=!0}}),"ontouchstart"in document){var e=document,i=this._touchstart.bind(this),n=this._touchmove.bind(this),o=this._touchend.bind(this),s=!!t&&{passive:!1,capture:!1};e.addEventListener("touchstart",i,s),e.addEventListener("touchmove",n,s),e.addEventListener("touchend",o),e.addEventListener("touchcancel",o)}}return a.getInstance=function(){return a._instance},a.prototype._touchstart=function(t){var e=this;if(this._shouldHandle(t)){if(Date.now()-this._lastClick<a._DBLCLICK&&this._dispatchEvent(t,"dblclick",t.target))return t.preventDefault(),void this._reset();this._reset();var i=this._closestDraggable(t.target);i&&(this._dispatchEvent(t,"mousemove",t.target)||this._dispatchEvent(t,"mousedown",t.target)||(this._dragSource=i,this._ptDown=this._getPoint(t),(this._lastTouch=t).preventDefault(),setTimeout(function(){e._dragSource==i&&null==e._img&&e._dispatchEvent(t,"contextmenu",i)&&e._reset()},a._CTXMENU)))}},a.prototype._touchmove=function(t){if(this._shouldHandle(t)){var e=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",e))return void(this._lastTouch=t).preventDefault();if(this._dragSource&&!this._img){var i=this._getDelta(t);a._THRESHOLD<i&&(this._dispatchEvent(t,"dragstart",this._dragSource),this._createImage(t),this._dispatchEvent(t,"dragenter",e))}this._img&&((this._lastTouch=t).preventDefault(),e!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",e),this._lastTarget=e),this._moveImage(t),this._dispatchEvent(t,"dragover",e))}},a.prototype._touchend=function(t){if(this._shouldHandle(t)){if(this._dispatchEvent(this._lastTouch,"mouseup",t.target))return void t.preventDefault();this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",t.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},a.prototype._shouldHandle=function(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2},a.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._dataTransfer=new e},a.prototype._getPoint=function(t,e){return t&&t.touches&&(t=t.touches[0]),{x:e?t.pageX:t.clientX,y:e?t.pageY:t.clientY}},a.prototype._getDelta=function(t){var e=this._getPoint(t);return Math.abs(e.x-this._ptDown.x)+Math.abs(e.y-this._ptDown.y)},a.prototype._getTarget=function(t){for(var e=this._getPoint(t),i=document.elementFromPoint(e.x,e.y);i&&"none"==getComputedStyle(i).pointerEvents;)i=i.parentElement;return i},a.prototype._createImage=function(t){this._img&&this._destroyImage();var e=this._imgCustom||this._dragSource;if(this._img=e.cloneNode(!0),this._copyStyle(e,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var i=e.getBoundingClientRect(),n=this._getPoint(t);this._imgOffset={x:n.x-i.left,y:n.y-i.top},this._img.style.opacity=a._OPACITY.toString()}this._moveImage(t),document.body.appendChild(this._img)},a.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},a.prototype._moveImage=function(i){var n=this;requestAnimationFrame(function(){if(n._img){var t=n._getPoint(i,!0),e=n._img.style;e.position="absolute",e.pointerEvents="none",e.zIndex="999999",e.left=Math.round(t.x-n._imgOffset.x)+"px",e.top=Math.round(t.y-n._imgOffset.y)+"px"}})},a.prototype._copyProps=function(t,e,i){for(var n=0;n<i.length;n++){var o=i[n];t[o]=e[o]}},a.prototype._copyStyle=function(t,e){if(a._rmvAtts.forEach(function(t){e.removeAttribute(t)}),t instanceof HTMLCanvasElement){var i=t,n=e;n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(i,0,0)}for(var o=getComputedStyle(t),s=0;s<o.length;s++){var r=o[s];r.indexOf("transition")<0&&(e.style[r]=o[r])}e.style.pointerEvents="none";for(s=0;s<t.children.length;s++)this._copyStyle(t.children[s],e.children[s])},a.prototype._dispatchEvent=function(t,e,i){if(t&&i){var n=document.createEvent("Event"),o=t.touches?t.touches[0]:t;return n.initEvent(e,!0,!0),n.button=0,n.which=n.buttons=1,this._copyProps(n,t,a._kbdProps),this._copyProps(n,o,a._ptProps),n.dataTransfer=this._dataTransfer,i.dispatchEvent(n),n.defaultPrevented}return!1},a.prototype._closestDraggable=function(t){for(;t;t=t.parentElement)if(t.hasAttribute("draggable")&&t.draggable)return t;return null},a}();o._instance=new o,o._THRESHOLD=5,o._OPACITY=.5,o._DBLCLICK=500,o._CTXMENU=900,o._rmvAtts="id,class,style,draggable".split(","),o._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),o._ptProps="pageX,pageY,clientX,clientY,screenX,screenY".split(","),t.DragDropTouch=o}(DragDropTouch||(DragDropTouch={}));